# Dejar un servidor nginx funcionando en un entorno

-   hosts: all

    gather_facts: True
    
    vars: {}
    
    pre_tasks:
        -   name: Obtener la versión de nginx instalada
            register: version
        
        -   block:
                -   name: Asegurarnos que el servicio de nginx está detenido
                
                    # En función del SO:
                -   name: Desinstalar el nginx
            when: # Si la versión instala no es la quiero
            
    tasks:
        # En función del SO:
        -   name:   Asegurarme que la versión de nginx que me pidan queda instalada.  # NGINX

        -   name:   Asegurarme que nginx queda configurado como debe estarlo          # CONFIGURACION
            notify: reiniciar-servicio

            
    post_tasks:

        -   name:   Asegurarme que el servicio quede arrancado
        
    
    handlers:
        -   name:   Reiniciar el servicio
            listen: reiniciar-servicio


################################################################################          
#NGINX :             OK          CHANGED     OK          CHANGED
#CONFIGURACION:      OK          OK          CHANGED     CHANGED
#SERVICIO???:        VVVV        VVVVVV      Reinicio    Arrancar(reinicio)
#                    Asegurarme que el servicio está arrancado:
#                        Si ya está arrancado, que hago? NADA
#                        Si no lo estuviera?             ARRANCO

# Quitar las cochinadas que nos pone nginx por defecto

# Configurar ese algo que voy a poner dentro del nginx : Copiar otro fichero de conf. 

# Tendré que poner algo dentro del nginx < Depsliegue de mi app... Copiar mi app en una carpeta

# Configurar un servicio -> Activarlo con la maquina


# Abrir la comunicación del puerto

# Pruebas al final
    # Probar nginx
    # Probar aplicacion
    # Probar comunicacion



# IDEMPOTENCIA: Da igual el estado inicial, siempre alcanzo el mismo estado final

# Y si vuelvo a ejecutar el playbook más adelante?
# Que pasa si ya tengo un nginx instalado y corriendo y me piden una nueva version de nginx?
# Pero me piden una nueva configuración del nginx